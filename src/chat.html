<!DOCTYPE html>
<html lang="en">

<head>
    <link rel="stylesheet" href="style.css">
    <title>Flamed Chat Room</title>
    <script src="/socket.io/socket.io.js"></script>
    <script>
        let socket;
        document.addEventListener("DOMContentLoaded", function() {
            const user = JSON.parse(localStorage.getItem("flamed_user") || "null");
            const chatBox = document.getElementById("chat-box");
            const form = document.getElementById("chat-form");
            const input = document.getElementById("chat-input");
            const userInfo = document.getElementById("user-info");

            if (!user) {
                window.location.href = "login.html";
                return;
            }

            userInfo.textContent = `Logged in as: ${user.username} [${user.rank}]`;

            socket = io();

            socket.emit('login', user);

            socket.on('chatMessage', data => {
                const div = document.createElement("div");
                div.innerHTML = `<span style="color:#00ff00;">${data.username}</span> <span style="color:#888;">[${data.rank}]</span>: ${data.message}`;
                chatBox.appendChild(div);
                chatBox.scrollTop = chatBox.scrollHeight;
            });

            form.addEventListener("submit", function(e) {
                e.preventDefault();
                const msg = input.value.trim();
                if (msg) {
                    socket.emit('chatMessage', msg);
                    input.value = "";
                }
            });
        });
    </script>
</head>

<body>
    <div class="terminal">
        <div id="user-info" style="margin-bottom:1em;"></div>
        <div id="chat-box" style="height:50vh;overflow-y:auto;border:1px solid #00ff00;padding:8px;margin-bottom:1em;width:100%;"></div>
        <form id="chat-form" autocomplete="off" style="width:100%;">
            <label for="chat-input" style="display:inline;">$ </label>
            <input id="chat-input" type="text" style="background:transparent;border:none;color:#00ff00;font-family:inherit;font-size:1em;outline:none;width:80%;">
            <button type="submit" style="margin-left:8px;">Send</button>
        </form>
    </div>
</body>

</html>